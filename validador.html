
<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>Validador WIN & Motor</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .hidden { display: none; }
    .valido { color: green; font-weight: bold; }
    .invalido { color: red; font-weight: bold; }
    .secao { border: 1px solid #ccc; padding: 15px; margin-top: 15px; border-radius: 10px; }
    .feedback-table { border-collapse: collapse; margin-top: 10px; }
    .feedback-table td, .feedback-table th { border: 1px solid #ccc; padding: 5px 10px; }
    button { margin-right: 10px; margin-top: 10px; }
  </style>
</head>
<body>
  <h2>Validador de Identificação de Embarcações</h2>
  <button onclick="mostrarSecao('win')">Validar WIN</button>
  <button onclick="mostrarSecao('motor')">Validar Motor</button>
  <button onclick="window.location.href='login.html'">Logout</button>

  <!-- Seção WIN -->
  <div id="secaoWin" class="secao">
    <h3>Validador WIN</h3>
    <input type="text" id="winInput" placeholder="Introduz número WIN" size="40">
    <button onclick="validarWIN()">Validar</button>
    <button onclick="window.location.href='historico_win.html'">Ver Histórico WIN</button>
    <div id="resultadoWIN"></div>
  </div>

  <!-- Seção Motor -->
  <div id="secaoMotor" class="secao hidden">
    <h3>Validador de Motor</h3>
    <label>Marca:</label>
    <select id="marca" onchange="mostrarCamposMotor()">
      <option value="">-- Selecionar marca --</option>
      <option value="Yamaha">Yamaha</option>
      <option value="Honda">Honda</option>
      <option value="MercuryIn">Mercury (Inboard)</option>
      <option value="MercuryOut">Mercury (Outboard)</option>
      <option value="Suzuki">Suzuki</option>
    </select><br>

    <div id="camposMotor" style="margin-top:10px;"></div>

    <button onclick="validarMotor()">Validar</button>
    <button onclick="window.location.href='historico_motor.html'">Ver Histórico Motores</button>
    <div id="resultadoMotor"></div>
  </div>

  <script>
    function mostrarSecao(sec) {
      document.getElementById('secaoWin').classList.add('hidden');
      document.getElementById('secaoMotor').classList.add('hidden');
      if(sec==='win') document.getElementById('secaoWin').classList.remove('hidden');
      if(sec==='motor') document.getElementById('secaoMotor').classList.remove('hidden');
    }

    function salvarHistoricoWIN(win,val,msg){
      const h=JSON.parse(localStorage.getItem('hisWIN')||'[]');
      h.unshift({data:new Date().toLocaleString(),win,val,msg});
      localStorage.setItem('hisWIN',JSON.stringify(h));
    }

    function validarNumeroWIN(win) {
      win=win.replace(/-/g,'').trim().toUpperCase();
      if(win.length!==14&&win.length!==16) return {valido:false,mensagem:'WIN inválido',campos:[]};
      const pais=win.slice(0,2),fab=win.slice(2,5);
      const serie=win.length===14?win.slice(5,10):win.slice(5,12);
      const mes=win.length===14?win[10]:win[12];
      const ano=win.length===14?win[11]:win[13];
      const mod=win.length===14?win.slice(12):win.slice(14);
      return {valido:true,mensagem:'WIN válido',campos:[
        {nome:'País',valor:pais,interpretacao:pais},
        {nome:'Fab',valor:fab,interpretacao:fab},
        {nome:'Série',valor:serie,interpretacao:'Livre'},
        {nome:'Mês',valor:mes,interpretacao:mes},
        {nome:'Ano Prod',valor:ano,interpretacao:ano},
        {nome:'Ano Mod',valor:mod,interpretacao:mod}
      ]};
    }

    function validarWIN(){
      const w=document.getElementById('winInput').value;
      const r=validarNumeroWIN(w);
      const d=document.getElementById('resultadoWIN');
      if(!r.valido){d.innerHTML=`<p class="invalido">${r.mensagem}</p>`;return;}
      let h=`<p class="valido">${r.mensagem}</p><table class="feedback-table"><tr><th>Campo</th><th>Valor</th><th>Interpretação</th></tr>`;
      r.campos.forEach(c=>h+=`<tr><td>${c.nome}</td><td>${c.valor}</td><td>${c.interpretacao}</td></tr>`);
      h+='</table>';d.innerHTML=h;
      salvarHistoricoWIN(w,r.valido,r.mensagem);
    }

    function mostrarCamposMotor(){
      const m=document.getElementById('marca').value;
      let html='';
      if(m==='Yamaha') html='<input id="campo1" placeholder="Ex: 6E5L123456"><br>';
      else if(m==='Honda') html='Frame SN:<input id="campo1" placeholder="Frame"><br>Engine SN:<input id="campo2" placeholder="Engine"><br>';
      else if(m==='MercuryIn') html='<input id="campo1" placeholder="SN Transom"><br>';
      else if(m==='MercuryOut') html='<input id="campo1" placeholder="SN Outboard"><br>';
      else if(m==='Suzuki') html='<input id="campo1" placeholder="Ex: DF1151234567"><br>';
      document.getElementById('camposMotor').innerHTML=html;
    }

    const regras={
      Yamaha:{regex:/^[A-Z0-9]{8,}$/},
      Honda:{regex:/^.+$/},
      MercuryIn:{regex:/^[0-9A-Z]{7,8}$/},
      MercuryOut:{regex:/^[0-3][A-Z][0-9]{6}$/},
      Suzuki:{regex:/^[A-Z]{2}[0-9]{2,3}[A-Z]*[0-9]{7}$/}
    };

    function validarMotor(){
      const m=document.getElementById('marca').value;
      const c1=document.getElementById('campo1')?document.getElementById('campo1').value:'';
      const c2=document.getElementById('campo2')?document.getElementById('campo2').value:'';
      const r=regras[m];
      let ok=false; let msg='';
      if(m==='Honda') ok=r.regex.test(c1)&&r.regex.test(c2), msg=ok?'Honda ok':'Honda invalido';
      else ok=r.regex.test(c1), msg=ok?m+' ok':m+' invalido';
      document.getElementById('resultadoMotor').innerHTML=`<p class="${ok?'valido':'invalido'}">${msg}</p>`;
      salvarHistoricoMotor(m,c1,c2,ok,msg);
    }

    function salvarHistoricoMotor(m,c1,c2,val,msg){
      const h=JSON.parse(localStorage.getItem('hisM')||'[]');
      h.unshift({data:new Date().toLocaleString(),m,c1,c2,val,msg});
      localStorage.setItem('hisM',JSON.stringify(h));
    }

    mostrarSecao('win');
  </script>
</body>
</html>
