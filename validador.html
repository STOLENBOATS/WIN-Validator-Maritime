
<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>Validador WIN & Motor</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 100%; box-sizing: border-box; }
    .hidden { display: none; }
    .valido { color: green; font-weight: bold; }
    .invalido { color: red; font-weight: bold; }
    .secao {
      max-width: 800px;
      margin: auto;
      border: 1px solid #ccc;
      padding: 15px;
      margin-top: 15px;
      border-radius: 10px;
      box-sizing: border-box;
    }
    .feedback-table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 10px;
    }
    .feedback-table td, .feedback-table th {
      border: 1px solid #ccc;
      padding: 5px 10px;
      text-align: left;
    }
    button { margin-right: 10px; margin-top: 10px; }
    input, select {
      padding: 5px;
      margin-top: 5px;
      width: 100%;
      max-width: 100%;
      box-sizing: border-box;
    }
    @media (max-width: 600px) {
      .feedback-table td, .feedback-table th {
        font-size: 12px;
        padding: 5px;
      }
    }
  </style>
</head>
<body onload="mostrarSecao('win')">
  <h2>Validador de Identificação de Embarcações</h2>
  <button onclick="mostrarSecao('win')">Validar WIN</button>
  <button onclick="mostrarSecao('motor')">Validar Motor</button>
  <button onclick="logout()">Logout</button>

  <!-- Seção WIN -->
  <div id="secaoWin" class="secao">
    <h3>Validador WIN</h3>
    <input type="text" id="winInput" placeholder="Introduz número WIN (14 ou 16 caracteres)">
    <button onclick="validarWIN()">Validar</button>
    <button onclick="window.location.href='historico_win.html'">Ver Histórico WIN</button>
    <div id="resultadoWIN"></div>
  </div>

  <!-- Seção Motor -->
  <div id="secaoMotor" class="secao hidden">
    <h3>Validador de Motor</h3>
    <label for="marca">Marca:</label><br>
    <select id="marca" onchange="mostrarCamposMotor()">
      <option value="">-- Selecionar marca --</option>
      <option value="Yamaha">Yamaha</option>
      <option value="Honda">Honda</option>
      <option value="MercuryIn">Mercury (Inboard)</option>
      <option value="MercuryOut">Mercury (Outboard)</option>
      <option value="Suzuki">Suzuki</option>
    </select>
    <div id="camposMotor" style="margin-top:10px;"></div>
    <button onclick="validarMotor()">Validar</button>
    <button onclick="window.location.href='historico_motor.html'">Ver Histórico Motores</button>
    <div id="resultadoMotor"></div>
  </div>

  <script>
    function logout() {
      window.location.href = 'login.html';
    }
    function mostrarSecao(sec) {
      ['secaoWin','secaoMotor'].forEach(id => document.getElementById(id).classList.add('hidden'));
      if (sec === 'win') document.getElementById('secaoWin').classList.remove('hidden');
      if (sec === 'motor') document.getElementById('secaoMotor').classList.remove('hidden');
    }

    function salvarHistoricoWIN(win, valido, msg) {
      const h = JSON.parse(localStorage.getItem('hisWIN')||'[]');
      h.unshift({ data: new Date().toLocaleString(), win, valido, msg });
      localStorage.setItem('hisWIN', JSON.stringify(h));
    }

    function validarNumeroWIN(win) {
      const r = { valido: false, mensagem: '', campos: [] };
      win = win.replace(/-/g,'').trim().toUpperCase();
      if (![14,16].includes(win.length)) {
        r.mensagem = 'WIN inválido: deve ter 14 ou 16 caracteres.';
        return r;
      }
      const pais = win.slice(0,2), fab = win.slice(2,5);
      if (/\d/.test(pais) || /\d/.test(fab)) {
        r.mensagem = 'Códigos país/fabricante inválidos.'; return r;
      }
      const serie = win.length===14? win.slice(5,10) : win.slice(5,12);
      const mesL = win.length===14? win[10] : win[12];
      const anoP = win.length===14? win[11] : win[13];
      const anoM = win.length===14? win.slice(12) : win.slice(14);
      r.valido = true; r.mensagem = 'WIN válido.';
      r.campos = [
        { nome:'País', valor: pais, interpretacao: pais },
        { nome:'Fabricante', valor: fab, interpretacao: fab },
        { nome:'Série', valor: serie, interpretacao: 'Livre' },
        { nome:'Mês', valor: mesL, interpretacao: mesL },
        { nome:'Ano Prod.', valor: anoP, interpretacao: anoP },
        { nome:'Ano Mod.', valor: anoM, interpretacao: anoM }
      ];
      return r;
    }

    function validarWIN() {
      const w = document.getElementById('winInput').value;
      const res = validarNumeroWIN(w);
      const div = document.getElementById('resultadoWIN');
      if (!res.valido) { div.innerHTML = `<p class="invalido">${res.mensagem}</p>`; return; }
      let out = `<p class="valido">${res.mensagem}</p><table class="feedback-table"><tr><th>Campo</th><th>Valor</th><th>Interpretação</th></tr>`;
      res.campos.forEach(c => { out += `<tr><td>${c.nome}</td><td>${c.valor}</td><td>${c.interpretacao}</td></tr>`; });
      out += '</table>'; div.innerHTML = out;
      salvarHistoricoWIN(w, res.valido, res.mensagem);
    }

    const regrasMotor = {
      Yamaha: { regex: /^[A-Z0-9]{8,}$/ },
      Honda: { regex: /^[A-Z0-9]+$/ },
      MercuryIn: { regex: /^[0-9A-Z]{7,8}$/ },
      MercuryOut: { regex: /^[0-3][A-Z][0-9]{6}$/ },
      Suzuki: { regex: /^[A-Z]{2}[0-9]{2,3}[A-Z]*[0-9]{7}$/ }
    };
    function mostrarCamposMotor() {
      const m = document.getElementById('marca').value;
      let html = '';
      if (m==='Yamaha' || m==='MercuryOut' || m==='Suzuki') {
        html = '<input id="campo1" placeholder="Insere série"><br>';
      } else if (m==='Honda') {
        html = 'Frame SN:<input id="campo1" placeholder="Frame SN"><br>' +
               'Engine SN:<input id="campo2" placeholder="Engine SN"><br>';
      } else if (m==='MercuryIn') {
        html = '<input id="campo1" placeholder="SN Transom"><br>';
      }
      document.getElementById('camposMotor').innerHTML = html;
    }

    function salvarHistoricoMotor(m, c1, c2, val, msg) {
      const h = JSON.parse(localStorage.getItem('hisMotor')||'[]');
      h.unshift({ data:new Date().toLocaleString(), marca:m, campo1:c1, campo2:c2, valido:val, msg });
      localStorage.setItem('hisMotor', JSON.stringify(h));
    }

    function validarMotor() {
      const m = document.getElementById('marca').value;
      const c1 = document.getElementById('campo1')?.value || '';
      const c2 = document.getElementById('campo2')?.value || '';
      const regra = regrasMotor[m];
      let valido = false, msg = 'Marca não suportada ou número inválido.';
      if (regra && regra.regex.test(c1)) {
        valido = true;
        msg = 'Número de motor válido.';
        if (m==='Honda' && c1 !== c2) {
          valido = false;
          msg = 'SN do Frame e do Bloco não coincidem.';
        }
      }
      salvarHistoricoMotor(m, c1, c2, valido, msg);
      document.getElementById('resultadoMotor').innerHTML = `<p class="${valido?'valido':'invalido'}">${msg}</p>`;
    }
  </script>
</body>
</html>
