<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>Validador WIN & Motor</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .hidden { display: none; }
    .valido { color: green; font-weight: bold; }
    .invalido { color: red; font-weight: bold; }
    .secao { border: 1px solid #ccc; padding: 15px; margin-top: 15px; border-radius: 10px; }
    .feedback-table { border-collapse: collapse; width: 100%; margin-top: 10px; }
    .feedback-table td, .feedback-table th { border: 1px solid #ccc; padding: 5px 10px; text-align: left; }
    button { margin-right: 10px; margin-top: 10px; }
    input, select { padding: 5px; margin-top: 5px; }
  </style>
</head>
<body onload="mostrarSecao('win')">
  <h2>Validador de Identificação de Embarcações</h2>
  <button onclick="mostrarSecao('win')">Validar WIN</button>
  <button onclick="mostrarSecao('motor')">Validar Motor</button>
  <button onclick="logout()">Logout</button>

  <!-- Seção WIN -->
  <div id="secaoWin" class="secao">
    <h3>Validador WIN</h3>
    <input type="text" id="winInput" placeholder="Introduz número WIN (14 ou 16 caracteres)" size="40">
    <button onclick="validarWIN()">Validar</button>
    <button onclick="mostrarHistoricoWIN()">Ver Histórico WIN</button>
    <div id="resultadoWIN"></div>
    <div id="historicoWIN" class="hidden"></div>
  </div>

  <!-- Seção Motor -->
  <div id="secaoMotor" class="secao hidden">
    <h3>Validador de Motor</h3>
    <label for="marca">Marca:</label><br>
    <select id="marca" onchange="mostrarCamposMotor()">
      <option value="">-- Selecionar marca --</option>
      <option value="Yamaha">Yamaha</option>
      <option value="Honda">Honda</option>
      <option value="MercuryIn">Mercury (Inboard)</option>
      <option value="MercuryOut">Mercury (Outboard)</option>
      <option value="Suzuki">Suzuki</option>
    </select>
    <div id="camposMotor" style="margin-top:10px;"></div>
    <button onclick="validarMotor()">Validar</button>
    <button onclick="mostrarHistoricoMotor()">Ver Histórico Motores</button>
    <div id="resultadoMotor"></div>
    <div id="historicoMotor" class="hidden"></div>
  </div>

  <script>
    function logout() {
      window.location.href = 'login.html';
    }
    function mostrarSecao(sec) {
      ['secaoWin','secaoMotor','historicoWIN','historicoMotor'].forEach(id => document.getElementById(id).classList.add('hidden'));
      if (sec === 'win') document.getElementById('secaoWin').classList.remove('hidden');
      if (sec === 'motor') document.getElementById('secaoMotor').classList.remove('hidden');
    }

    // Histórico WIN
    function salvarHistoricoWIN(win, valido, msg) {
      const h = JSON.parse(localStorage.getItem('hisWIN')||'[]');
      h.unshift({ data: new Date().toLocaleString(), win, valido, msg });
      localStorage.setItem('hisWIN', JSON.stringify(h));
    }
    function mostrarHistoricoWIN() {
      const h = JSON.parse(localStorage.getItem('hisWIN')||'[]');
      let t = '<table class="feedback-table"><tr><th>Data</th><th>WIN</th><th>Válido</th><th>Mensagem</th></tr>';
      h.forEach(e => { t += `<tr><td>${e.data}</td><td>${e.win}</td><td>${e.valido}</td><td>${e.msg}</td></tr>`; });
      t += '</table>';
      const d = document.getElementById('historicoWIN'); d.innerHTML = t; d.classList.remove('hidden');
    }

    function validarNumeroWIN(win) {
      const r = { valido: false, mensagem: '', campos: [] };
      win = win.replace(/-/g,'').trim().toUpperCase();
      if (![14,16].includes(win.length)) {
        r.mensagem = 'WIN inválido: deve ter 14 ou 16 caracteres.';
        return r;
      }
      const pais = win.slice(0,2), fab = win.slice(2,5);
      if (/\d/.test(pais) || /\d/.test(fab)) {
        r.mensagem = 'Códigos país/fabricante inválidos.'; return r;
      }
      const serie = win.length===14? win.slice(5,10) : win.slice(5,12);
      const mesL = win.length===14? win[10] : win[12];
      const anoP = win.length===14? win[11] : win[13];
      const anoM = win.length===14? win.slice(12) : win.slice(14);
      r.valido = true; r.mensagem = 'WIN válido.';
      r.campos = [
        { nome:'País', valor: pais, interpretacao: pais },
        { nome:'Fabricante', valor: fab, interpretacao: fab },
        { nome:'Série', valor: serie, interpretacao: 'Livre' },
        { nome:'Mês', valor: mesL, interpretacao: mesL },
        { nome:'Ano Prod.', valor: anoP, interpretacao: anoP },
        { nome:'Ano Mod.', valor: anoM, interpretacao: anoM }
      ];
      return r;
    }
    function validarWIN() {
      const w = document.getElementById('winInput').value;
      const res = validarNumeroWIN(w);
      const div = document.getElementById('resultadoWIN');
      if (!res.valido) { div.innerHTML = `<p class="invalido">${res.mensagem}</p>`; return; }
      let out = `<p class="valido">${res.mensagem}</p><table class="feedback-table"><tr><th>Campo</th><th>Valor</th><th>Interpretação</th></tr>`;
      res.campos.forEach(c => { out += `<tr><td>${c.nome}</td><td>${c.valor}</td><td>${c.interpretacao}</td></tr>`; });
      out += '</table>'; div.innerHTML = out;
      salvarHistoricoWIN(w, res.valido, res.mensagem);
    }

    // Motor
    const regrasMotor = {
      Yamaha: { regex: /^[A-Z0-9]{8,}$/ },
      Honda: { regex: /^[A-Z0-9]+$/ },
      MercuryIn: { regex: /^[0-9A-Z]{7,8}$/ },
      MercuryOut: { regex: /^[0-3][A-Z][0-9]{6}$/ },
      Suzuki: { regex: /^[A-Z]{2}[0-9]{2,3}[A-Z]*[0-9]{7}$/ }
    };
    const infoMotor = {
      Yamaha: { campos:['Etiqueta'], descricao:'Formato: código+serial', notas:'Sem Jet Drive'},
      Honda: { campos:['FrameSN','EngineSN'], descricao:'2 etiquetas (transom e bloco)', notas:'Devem coincidir'},
      MercuryIn: { campos:['TransomSN'], descricao:'Inboard Transom SN', notas:'Obrigatório'},
      MercuryOut: { campos:['OutboardSN'], descricao:'Outboard SN padrão', notas:'Prefixo 0-3'},
      Suzuki: { campos:['Etiqueta'], descricao:'DF/DT + 7 dígitos', notas:'Verificar prefixo'}
    };
    function mostrarCamposMotor() {
      const m = document.getElementById('marca').value;
      let html = '';
      if (m==='Yamaha' || m==='MercuryOut' || m==='Suzuki') {
        html = '<input id="campo1" placeholder="Insere série"><br>';
      } else if (m==='Honda') {
        html = 'Frame SN:<input id="campo1" placeholder="Frame SN"><br>' +
               'Engine SN:<input id="campo2" placeholder="Engine SN"><br>';
      } else if (m==='MercuryIn') {
        html = '<input id="campo1" placeholder="SN Transom"><br>';
      }
      document.getElementById('camposMotor').innerHTML = html;
    }
    function salvarHistoricoMotor(m, c1, c2, val, msg) {
      const h = JSON.parse(localStorage.getItem('hisMotor')||'[]');
      h.unshift({ data:new Date().toLocaleString(), marca:m, campo1:c1, campo2:c2, valido:val, msg });
      localStorage.setItem('hisMotor', JSON.stringify(h));
    }
    function mostrarHistoricoMotor() {
      const h = JSON.parse(localStorage.getItem('hisMotor')||'[]');
      let t = '<table class="feedback-table"><tr><th>Data</th><th>Marca</th><th>Campo1</th><th>Campo2</th><th>Válido</th><th>Msg</th></tr>';
      h.forEach(e=>{ t += `<tr><td>${e.data}</td><td>${e.marca}</td><td>${e.campo1}</td><td>${e.campo2||''}</td><td>${e.valido}</td><td>${e.msg}</td></tr>`; });
      t += '</table>';
      const d = document.getElementById('historicoMotor'); d.innerHTML = t; d.classList.remove('hidden');
    }
  </script>

<!-- Motor Interpretation Visual Info -->
<div id="motorInterpretation" style="display:none; margin-top: 20px;">
  <h3>Interpretação do Número de Motor</h3>
  <table border="1" cellpadding="8" style="border-collapse: collapse; width: 100%;">
    <thead>
      <tr>
        <th>Campo</th>
        <th>Valor Inserido</th>
        <th>Interpretação</th>
      </tr>
    </thead>
    <tbody id="motorInterpretationBody">
      <!-- Conteúdo gerado dinamicamente -->
    </tbody>
  </table>
</div>
<script>
  function showMotorInterpretation(marca, dados) {
    const table = document.getElementById("motorInterpretation");
    const body = document.getElementById("motorInterpretationBody");
    body.innerHTML = "";

    if (marca === "Yamaha") {
      const interpretacao = [
        { campo: "Modelo", valor: dados.modelo, descricao: "Ex: F350NSA → F350: 350hp, N: América do Norte, S: Long shaft, A: 1ª versão" },
        { campo: "Código", valor: dados.codigo, descricao: "Código interno Yamaha (ex: 6ML)" },
        { campo: "Letra Ano", valor: dados.letraAno, descricao: "Ex: N = 2022 (conforme tabela oficial Yamaha)" },
        { campo: "Nº Série", valor: dados.numeroSerie, descricao: "Número sequencial de produção" }
      ];
      interpretacao.forEach(item => {
        const row = `<tr><td>${item.campo}</td><td>${item.valor}</td><td>${item.descricao}</td></tr>`;
        body.innerHTML += row;
      });
      table.style.display = "block";
    }
    else if (marca === "Honda") {
      const interpretacao = [
        { campo: "Modelo", valor: dados.modelo, descricao: "Ex: BF90A2 → 90hp, geração A, versão 2" },
        { campo: "Número de Série", valor: dados.numeroSerie, descricao: "Número de produção interna Honda" },
        { campo: "Ano Fabrico", valor: dados.ano, descricao: "Ex: M = 2021 (consultar tabela alfabética Honda)" }
      ];
      interpretacao.forEach(item => {
        const row = `<tr><td>${item.campo}</td><td>${item.valor}</td><td>${item.descricao}</td></tr>`;
        body.innerHTML += row;
      });
      table.style.display = "block";
    }
    else {
      table.style.display = "none";
    }
  }
</script>

</body>
</html>