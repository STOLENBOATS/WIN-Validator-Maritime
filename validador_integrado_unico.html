
<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>Validador WIN & Motor</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .hidden { display: none; }
    .valido { color: green; font-weight: bold; }
    .invalido { color: red; font-weight: bold; }
    .resultado { margin-top: 20px; }
    .secao { border: 1px solid #ccc; padding: 15px; border-radius: 8px; margin-top: 15px; }
    table { border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #aaa; padding: 5px 10px; }
  </style>
</head>
<body>
  <h2>Validador de Identifica√ß√£o de Embarca√ß√µes</h2>
  <button onclick="mostrarSecao('win')">Validar WIN</button>
  <button onclick="mostrarSecao('motor')">Validar Motor</button>

  <div id="secaoWin" class="secao">
    <h3>Validador WIN</h3>
    <input type="text" id="winInput" placeholder="Introduz n√∫mero WIN">
    <button onclick="validarWIN()">Validar</button>
    <div id="resultadoWIN"></div>
  </div>

  <div id="secaoMotor" class="secao hidden">
    <h3>Validador de Motor</h3>
    <select id="marca">
      <option value="Yamaha">Yamaha</option>
      <option value="Honda">Honda</option>
    </select><br><br>
    <input type="text" id="numero" placeholder="Insere n√∫mero de motor"><br>
    <button onclick="validarMotor()">Validar</button>
    <div class="resultado" id="resultadoMotor"></div>
  </div>

  <script>
    function mostrarSecao(secao) {
      document.getElementById('secaoWin').classList.add('hidden');
      document.getElementById('secaoMotor').classList.add('hidden');
      document.getElementById('secao' + secao.charAt(0).toUpperCase() + secao.slice(1)).classList.remove('hidden');
    }

    function validarNumeroWIN(win) {
      const original = win;
      win = win.replace(/-/g, "").trim().toUpperCase();
      const resposta = { valido: false, mensagem: "", campos: [] };

      if (win.length !== 14 && win.length !== 16) {
        resposta.mensagem = "N√∫mero WIN inv√°lido: deve ter 14 ou 16 caracteres (excluindo h√≠fen).";
        return resposta;
      }

      const pais = win.slice(0, 2);
      const fabricante = win.slice(2, 5);

      if (/\d/.test(pais) || /\d/.test(fabricante)) {
        resposta.mensagem = "C√≥digo de pa√≠s ou fabricante inv√°lido: n√£o pode conter n√∫meros.";
        return resposta;
      }

      const serieLivre = win.length === 14 ? win.slice(5, 10) : win.slice(5, 12);
      const mesLetra = win.length === 14 ? win[10] : win[12];
      const anoNumero = win.length === 14 ? win[11] : win[13];
      const modelo = win.length === 14 ? win.slice(12, 14) : win.slice(14, 16);

      const meses = {
        A: "Janeiro", B: "Fevereiro", C: "Mar√ßo", D: "Abril", E: "Maio", F: "Junho",
        G: "Julho", H: "Agosto", J: "Setembro", K: "Outubro", L: "Novembro", M: "Dezembro",
        N: "Reservado", P: "Reservado", R: "Reservado", S: "Reservado", T: "Reservado",
        U: "Reservado", V: "Reservado", W: "Reservado", X: "Reservado", Y: "Reservado", Z: "Reservado"
      };

      if (!meses[mesLetra] || ["I", "O", "Q"].includes(mesLetra)) {
        resposta.mensagem = "Letra do m√™s inv√°lida.";
        return resposta;
      }

      if (!/^[0-9]$/.test(anoNumero)) {
        resposta.mensagem = "Ano de produ√ß√£o inv√°lido.";
        return resposta;
      }

      if (!/^[0-9]{2}$/.test(modelo)) {
        resposta.mensagem = "Ano do modelo inv√°lido.";
        return resposta;
      }

      resposta.valido = true;
      resposta.mensagem = "N√∫mero WIN v√°lido. Interpreta√ß√£o abaixo:";
      resposta.campos.push({ nome: "Pa√≠s", valor: pais, interpretacao: pais === "FR" ? "üá´üá∑ Fran√ßa" : pais });
      resposta.campos.push({ nome: "Fabricante", valor: fabricante, interpretacao: fabricante === "CNB" ? "CNB Yacht Builder" : fabricante });
      resposta.campos.push({ nome: "S√©rie", valor: serieLivre, interpretacao: "N√∫mero de registo livre" });
      resposta.campos.push({ nome: "M√™s de produ√ß√£o", valor: mesLetra, interpretacao: meses[mesLetra] });
      resposta.campos.push({ nome: "Ano de produ√ß√£o", valor: anoNumero, interpretacao: "200" + anoNumero });
      resposta.campos.push({ nome: "Ano do modelo", valor: modelo, interpretacao: "20" + modelo });

      return resposta;
    }

    const regrasMotor = {
      "Yamaha": {
        regex: /^[A-Z0-9\s]{10,}$/,
        camposEsperados: ["Modelo", "C√≥digo", "Comprimento do veio", "N√∫mero de s√©rie"],
        descricao: "Formato padr√£o da etiqueta Yamaha (modelo + c√≥digo + comprimento + n√∫mero).",
        notas: "Validar integridade visual e tipo de propuls√£o (sem Jet Drive em modelos fora de borda)."
      },
      "Honda": {
        regex: /^BF[0-9]{2,3}[A-Z]{2}\s[0-9]{7}$/,
        camposEsperados: ["Modelo", "Letra de revis√£o", "N√∫mero de s√©rie"],
        descricao: "Etiqueta com selo de modelo e n√∫mero em √°rea diferente do bloco motor.",
        notas: "Confirmar que existem 2 etiquetas distintas no motor."
      }
    };

    function validarNumeroMotor(marca, numero) {
      if (!regrasMotor[marca]) {
        return {
          valido: false,
          mensagem: "Marca n√£o suportada.",
          camposEsperados: [],
          descricao: "",
          notas: ""
        };
      }
      const regra = regrasMotor[marca];
      const regex = new RegExp(regra.regex);
      const valido = regex.test(numero);
      return {
        valido,
        mensagem: valido ? "N√∫mero de motor v√°lido para " + marca : "Formato inv√°lido para " + marca,
        camposEsperados: regra.camposEsperados,
        descricao: regra.descricao,
        notas: regra.notas
      };
    }

    function validarMotor() {
      const marca = document.getElementById("marca").value;
      const numero = document.getElementById("numero").value;
      const res = validarNumeroMotor(marca, numero);
      const div = document.getElementById("resultadoMotor");
      div.innerHTML = `
        <p class="${res.valido ? 'valido' : 'invalido'}">${res.mensagem}</p>
        <p><strong>Campos:</strong> ${res.camposEsperados.join(', ')}</p>
        <p><strong>Descri√ß√£o:</strong> ${res.descricao}</p>
        <p><strong>Notas:</strong> ${res.notas}</p>`;
    }

    function validarWIN() {
      const win = document.getElementById("winInput").value;
      const resultado = validarNumeroWIN(win);
      const div = document.getElementById("resultadoWIN");
      if (!resultado.valido) {
        div.innerHTML = `<p class="invalido">${resultado.mensagem}</p>`;
        return;
      }
      let html = `<p class="valido">${resultado.mensagem}</p><table><tr><th>Campo</th><th>Valor</th><th>Interpreta√ß√£o</th></tr>`;
      resultado.campos.forEach(c => {
        html += `<tr><td>${c.nome}</td><td>${c.valor}</td><td>${c.interpretacao}</td></tr>`;
      });
      html += `</table>`;
      div.innerHTML = html;
    }
  </script>
</body>
</html>
